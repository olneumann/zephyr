/*
 * Copyright (c) 2024 Oliver Neumann
 *
 * SPDX-License-Identifier: Apache-2.0
 */

#ifndef __SENSOR_MMC5983MA_
#define __SENSOR_MMC5983MA_

#include <zephyr/drivers/i2c.h>

#define LSM303_DLHC_MAGN_X_EN_BIT	BIT(0)
#define MMC5983MA_Y_EN_BIT	BIT(1)
#define MMC5983MA_Z_EN_BIT	BIT(2)
#define MMC5983MA_EN_BITS		(LSM303_DLHC_MAGN_X_EN_BIT | \
					MMC5983MA_Y_EN_BIT | \
					MMC5983MA_Z_EN_BIT)

#if	(CONFIG_MMC5983MA_ODR == 0)
	#define MMC5983MA_DRDY_WAIT_TIME	134
#elif	(CONFIG_MMC5983MA_ODR == 1)
	#define MMC5983MA_DRDY_WAIT_TIME	67
#elif	(CONFIG_MMC5983MA_ODR == 2)
	#define MMC5983MA_DRDY_WAIT_TIME	34
#elif	(CONFIG_MMC5983MA_ODR == 3)
	#define MMC5983MA_DRDY_WAIT_TIME	14
#elif	(CONFIG_MMC5983MA_ODR == 4)
	#define MMC5983MA_DRDY_WAIT_TIME	7
#elif	(CONFIG_MMC5983MA_ODR == 5)
	#define MMC5983MA_DRDY_WAIT_TIME	4
#elif	(CONFIG_MMC5983MA_ODR == 6)
	#define MMC5983MA_DRDY_WAIT_TIME	2
#elif	(CONFIG_MMC5983MA_ODR == 7)
	#define MMC5983MA_DRDY_WAIT_TIME	1
#endif

#define MMC5983MA_ODR_SHIFT	2
#define MMC5983MA_ODR_BITS	(CONFIG_MMC5983MA_ODR << \
					MMC5983MA_ODR_SHIFT)

#if	(CONFIG_MMC5983MA_RANGE == 1)
	#define MMC5983MA_LSB_GAUSS_XY    1100
	#define MMC5983MA_LSB_GAUSS_Z     980
#elif	(CONFIG_MMC5983MA_RANGE == 2)
	#define MMC5983MA_LSB_GAUSS_XY    855
	#define MMC5983MA_LSB_GAUSS_Z     760
#elif	(CONFIG_MMC5983MA_RANGE == 3)
	#define MMC5983MA_LSB_GAUSS_XY    670
	#define MMC5983MA_LSB_GAUSS_Z     600
#elif	(CONFIG_MMC5983MA_RANGE == 4)
	#define MMC5983MA_LSB_GAUSS_XY    450
	#define MMC5983MA_LSB_GAUSS_Z     400
#elif	(CONFIG_MMC5983MA_RANGE == 5)
	#define MMC5983MA_LSB_GAUSS_XY    400
	#define MMC5983MA_LSB_GAUSS_Z     355
#elif	(CONFIG_MMC5983MA_RANGE == 6)
	#define MMC5983MA_LSB_GAUSS_XY    330
	#define MMC5983MA_LSB_GAUSS_Z     295
#elif	(CONFIG_MMC5983MA_RANGE == 7)
	#define MMC5983MA_LSB_GAUSS_XY    230
	#define MMC5983MA_LSB_GAUSS_Z     205
#endif

#define MMC5983MA_FS_SHIFT	5
#define MMC5983MA_FS_BITS		(CONFIG_MMC5983MA_RANGE << \
					MMC5983MA_FS_SHIFT)
#define MMC5983MA_CONT_UPDATE	0x00
#define MMC5983MA_DRDY		BIT(0)

#define MMC5983MA_CRA_REG_M		0x00
#define MMC5983MA_CRB_REG_M		0x01
#define MMC5983MA_MR_REG_M		0x02
#define MMC5983MA_REG_MAGN_X_LSB	0x03
#define MMC5983MA_SR_REG_M		0x09

struct MMC5983MA_data {
	int16_t magn_x;
	int16_t magn_y;
	int16_t magn_z;
};

struct MMC5983MA_config {
	struct i2c_dt_spec i2c;
};
#endif /* _SENSOR_MMC5983MA_ */
